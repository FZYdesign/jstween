/*!
 * GIT: https://github.com/shrekshrek/jstween
 **/

!function(t){if("function"==typeof define&&define.amd)define(["jstween","exports"],function(e,i){window.JTL=t(i,e)});else if("undefined"!=typeof exports){var e=require("jstween");t(exports,e)}else window.JTL=t({},window.JT)}(function(t,e){function i(t){var e=/(^[a-zA-Z]\w*|)(\+=|-=|)(\d*\.\d*|\d*)/,i=e.exec(t);return{label:i[1],ext:i[2],num:parseFloat(i[3])}}function s(){var t=h.length;if(0===t)return void(o=!1);var i=e.now(),n=i-p;p=i,r=h.slice(0);for(var u=0;t>u;u++){var m=r[u];m&&m.isPlaying&&!m._update(n)&&m.pause()}a(s)}function n(){this.initialize.apply(this,arguments)}var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},h=[],r=[],o=!1,p=0;return Object.assign(n.prototype,{initialize:function(t){t=t||{},this.duration=0,this.delay=1e3*Math.max(t.delay||0,0),this.yoyo=t.yoyo||!1,this.repeat=t.repeat||0,this.repeatDelay=1e3*Math.max(t.repeatDelay||0,0),this.onStart=t.onStart||null,this.onStartScope=t.onStartScope||this,this.onStartParams=t.onStartParams||[],this.onRepeat=t.onRepeat||null,this.onRepeatScope=t.onRepeatScope||this,this.onRepeatParams=t.onRepeatParams||[],this.onEnd=t.onEnd||null,this.onEndScope=t.onEndScope||this,this.onEndParams=t.onEndParams||[],this.onUpdate=t.onUpdate||null,this.onUpdateScope=t.onUpdateScope||this,this.onUpdateParams=t.onUpdateParams||[],this.isPlaying=!1,this.isReverse=t.isReverse||!1,this.timeScale=t.timeScale||1,this.isSeek=!1,this.isKeep=!1,this.isYoReverse=!1,this.repeat=this.repeat<0?999999999999:Math.floor(this.repeat),this.curRepeat=0,this.startTime=this.delay,this._updateEndTime(),this.curTime=0,this.prevTime=0,this.labels=[],this.tweens=[],this.calls=[]},_updateEndTime:function(){this.endTime=this.startTime+this.repeatDelay*this.repeat+this.duration*(this.repeat+1)},_update:function(t){if(this.isKeep=!1,t=(this.isReverse?-1:1)*t*this.timeScale,this.prevTime=this.curTime,this.curTime=this.prevTime+t,this.prevTime>0&&this.curTime<=0)return this.curTime=0,this._updateProp(),!this.isSeek&&this.onStart&&this.prevTime>this.startTime&&this.onStart.apply(this.onStartScope,this.onStartParams),this.isKeep;if(this.prevTime<this.endTime&&this.curTime>=this.endTime)return this.curTime=this.endTime,this._updateProp(),!this.isSeek&&this.onEnd&&this.onEnd.apply(this.onEndScope,this.onEndParams),this.isKeep;var e=Math.min(this.repeat,Math.max(0,Math.floor((this.curTime-this.startTime)/(this.duration+this.repeatDelay))));return e!==this.curRepeat&&(this.curRepeat=e,this.yoyo&&(this.isYoReverse=!this.isYoReverse),!this.isSeek&&this.onRepeat&&this.onRepeat.apply(this.onRepeatScope,this.onRepeatParams)),this._updateProp(),!this.isSeek&&this.onEnd&&this.prevTime>=this.endTime&&this.curTime<this.endTime&&this.onEnd.apply(this.onEndScope,this.onEndParams),!this.isSeek&&this.onStart&&(0===this.startTime&&0===this.prevTime&&this.curTime>this.startTime||this.prevTime<this.startTime&&this.curTime>=this.startTime||this.prevTime>this.startTime&&this.curTime<=this.startTime)&&this.onStart.apply(this.onStartScope,this.onStartParams),!0},_updateProp:function(){this._checkTween(),this.onUpdate&&this.onUpdate.apply(this.onUpdateScope,this.onUpdateParams)},_addSelf:function(){h.push(this),o||(p=e.now(),o=!0,a(s))},_removeSelf:function(){var t=h.indexOf(this);-1!==t&&h.splice(t,1)},_parsePosition:function(t){if(void 0===t)return this.duration;var e=i(t),s=0;if(e.label)s=this.getLabelTime(e.label);else if(e.ext){switch(e.ext){case"+=":s=this.duration+1e3*e.num;break;case"-=":s=this.duration-1e3*e.num}this._updateEndTime()}else e.num&&(s=1e3*e.num);return s},_addTween:function(t,e){t.stop();var i=this._parsePosition(e);this.duration=Math.max(this.duration,i+t.endTime),this.tweens.push({time:i,tween:t}),this._updateEndTime()},_checkTween:function(){for(var t=0,e=this.tweens.length;e>t;t++){var i=this.tweens[t],s=(this.prevTime-this.startTime)%(this.duration+this.repeatDelay),n=this.curTime===this.endTime?this.duration:(this.curTime-this.startTime)%(this.duration+this.repeatDelay);0===i.tween.endTime?!this.isSeek&&(0===i.time&&0===s&&n>0||!this.isReverse&&s<i.time&&n>=i.time||this.isReverse&&s>i.time&&n<=i.time)&&i.tween.onEnd&&i.tween.onEnd.apply(i.tween.onEndScope,i.tween.onEndParams):i.tween.seek((n-i.time)/1e3,this.isSeek)}},fromTo:function(t,i,s,n,a){return n.isPlaying=!1,this._addTween(e.fromTo(t,i,s,n),a),this},from:function(t,i,s,n){return s.isPlaying=!1,this._addTween(e.from(t,i,s),n),this},to:function(t,i,s,n){return s.isPlaying=!1,this._addTween(e.to(t,i,s),n),this},add:function(t,i){switch(typeof t){case"object":this._addTween(t,i);break;case"function":this._addTween(e.call(0,t,[],!1),i);break;case"string":this.addLabel(t,i);break;default:throw"add action is wrong!!!"}return this},remove:function(t){for(var e=this._parsePosition(t),i=this.calls.length,s=i-1;s>=0;s--){var n=this.calls[s];n.time==e&&this.calls.splice(s,1)}for(var i=this.tweens.length,s=i-1;s>=0;s--){var a=this.tweens[s];a.time==e&&this.tweens.splice(s,1)}return this},addLabel:function(t,e){this.removeLabel(t);var i=this._parsePosition(e);this.labels.push({name:t,time:i})},removeLabel:function(t){for(var e=0,i=this.labels.length;i>e;e++){var s=this.labels[e];if(t==s.name)return void this.labels.splice(e,1)}},getLabelTime:function(t){for(var e=0,i=this.labels.length;i>e;e++){var s=this.labels[e];if(t==s.name)return s.time}return null},totalTime:function(){return this.duration},play:function(t){return this.isReverse=!1,void 0!==t&&this.seek(t,!0),this.curTime===this.endTime?this.isKeep=!1:(this.isKeep=!0,void(this.isPlaying||(this.isPlaying=!0,this._addSelf())))},pause:function(){this.isKeep=!1,this.isPlaying&&(this.isPlaying=!1,this._removeSelf())},stop:function(){this.pause(),0!==this.curTime&&(this.curTime=this.curRepeat=0,this.isYoReverse=!1,this._updateProp())},reverse:function(t){return this.isReverse=!0,void 0!==t&&this.seek(t,!0),0===this.curTime?this.isKeep=!1:(this.isKeep=!0,void(this.isPlaying||(this.isPlaying=!0,this._addSelf())))},seek:function(t,e){var i=Math.max(0,Math.min(this.endTime,this._parsePosition(t)));this.curTime!==i&&(void 0!==e&&(this.isSeek=e),this._update(i-this.curTime),this.isSeek=!1)},kill:function(){this.pause(),this.tweens=[],this.calls=[],this.labels=[],this.duration=null,this.curTime=this.prevTime=this.startTime=this.endTime=null,this.onStart=this.onRepeat=this.onEnd=this.onUpdate=null}}),Object.assign(t,{create:function(t){return new n(t)},kill:function(t){t.kill()}}),t});
